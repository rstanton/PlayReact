{"version":3,"sources":["../../../js/listers/GenericLister.jsx"],"names":["GenericLister","props","componentDidMount","bind","getSchema","getData","showDialog","state","head","body","dialog","schema","console","debug","JSON","stringify","db","PouchDB","title","query","err","res","error","key","rows","map","doc","obj","td","field","properties","push","eval","setState","next","get","id","_id","th","x","button","$","React","Component"],"mappings":"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","file":"GenericLister.js","sourcesContent":["/**\n * Props will contain the ID of the schema object that describes the resource to be displayed\n * - Get the schema\n * - Open a connection to the relevant database\n * - Query for all objects\n * - Display a table containing the relevant properties\n */\nclass GenericLister extends React.Component{\n    constructor(props){\n        super(props);\n\n        this.componentDidMount = this.componentDidMount.bind(this);\n        this.getSchema = this.getSchema.bind(this);\n        this.getData = this.getData.bind(this);\n        this.showDialog = this.showDialog.bind(this);\n\n        this.state = {\n            head: [],\n            body: [],\n            dialog: \"\"\n        };\n    }\n\n    componentDidMount(){\n        //Reads the table header and passes the schema doc to 'getData'\n        this.getSchema(this.getData);\n    }\n\n    //@ToDo finish building table data rows\n    getData(schema){\n        console.debug(JSON.stringify(schema));\n\n        let db = new PouchDB(schema.title);\n\n\n        //execute the view to get the IDs of all the documents\n        db.query(schema.title+\"/by_name\", function(err,res){\n            if(err){\n                console.error(err);\n            }\n            else{\n                let body = [];\n\n                //Loop each record in the DB\n                let key =0;\n                res.rows.map(function(doc){\n                    console.debug(\"Processing Lister for \"+JSON.stringify(doc));\n\n                    let obj = doc.key;\n                    let td = [];\n\n                    //@Todo, need to use the schema here -> we need to get the attributes of the document based on the fields in the schema, can't just iterate over the object as there maybe missing / null fields.\n                    for(let field in schema.properties){\n                        console.debug(\"Processing \"+schema.title+\".\"+field);\n\n                        td.push(<td key={schema.title+\".\"+field}>{eval(\"obj.\"+field)}</td>);\n                    }\n\n                    body.push(<tr key={key}>{td}<td></td></tr>);\n                    key++;\n                });\n\n                this.setState({\n                    body:body\n                });\n            }\n        }.bind(this));\n    }\n\n\n    //Read the schema from the DB, display the table header and call on to next which should render the data table.\n    getSchema(next){\n        let db = new PouchDB(\"schemas\");\n\n        db.get(this.props.id, function(err, doc){\n            if(err){\n                console.error(err);\n            }\n            else{\n                console.debug(\"Building Table Header for \"+JSON.stringify(doc));\n\n                //Setup a new dialog\n                let dialog = <GenericDialog id={\"dialog\"+doc._id} body={\"New \"+doc.title} modal={true} schema={doc}/>;\n\n                let props = doc.properties;\n\n                let th=[];\n                for(let x in props){\n                    th.push(<th key={x}>{x}</th>);\n                }\n\n                let button = <th key=\"button\"><button onClick={() => this.showDialog(\"dialog\"+doc._id)} className=\"btn btn-primary\">{\"New \"+doc.title}</button></th>;\n                th.push(button);\n\n                this.setState({\n                    head:th,\n                    dialog:dialog\n                });\n            }\n            //now populate the data table\n            next(doc);\n        }.bind(this));\n    }\n\n    showDialog(id){\n        console.debug(\"Showing dialog with ID \"+id);\n\n        $(\"#\"+id).dialog(\"open\");\n    }\n\n    render(){\n        return <div>\n            {this.state.dialog}\n            <table className=\"table table-striped\">\n                <thead>\n                <tr>{this.state.head}</tr>\n                </thead>\n                <tbody>\n                {this.state.body}\n                </tbody>\n            </table>\n        </div>\n    }\n}"]}