{"version":3,"sources":["../../../js/listers/GenericLister.jsx"],"names":["GenericLister","props","componentDidMount","bind","getSchema","getData","showDialog","delete","state","head","body","dialog","schema","console","debug","JSON","stringify","db","PouchDB","title","query","err","res","error","key","rows","map","doc","obj","td","field","properties","push","eval","id","setState","get","remove","response","next","SCHEMA_DB","_id","th","x","button","$","React","Component"],"mappings":"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","file":"GenericLister.js","sourcesContent":["/**\n * Props will contain the ID of the schema object that describes the resource to be displayed\n * - Get the schema\n * - Open a connection to the relevant database\n * - Query for all objects\n * - Display a table containing the relevant properties\n */\nclass GenericLister extends React.Component{\n    constructor(props){\n        super(props);\n\n        this.componentDidMount = this.componentDidMount.bind(this);\n        this.getSchema = this.getSchema.bind(this);\n        this.getData = this.getData.bind(this);\n        this.showDialog = this.showDialog.bind(this);\n        this.delete = this.delete.bind(this);\n\n        this.state = {\n            head: [],\n            body: [],\n            dialog: \"\"\n        };\n    }\n\n    componentDidMount(){\n        //Reads the table header and passes the schema doc to 'getData'\n        this.getSchema(this.getData);\n    }\n\n    //@ToDo finish building table data rows\n    getData(schema){\n        console.debug(JSON.stringify(schema));\n\n        let db = new PouchDB(schema.title);\n\n\n        //The view now returns all of the documents (not the IDs)\n        db.query(schema.title+\"/by_name\", function(err,res){\n            if(err){\n                console.error(err);\n            }\n            else{\n                let body = [];\n\n                //Loop each record in the DB\n                let key =0;\n                res.rows.map(function(doc){\n                    console.debug(schema.title+\", Processing Lister for \"+JSON.stringify(doc.key));\n\n                    let obj = doc.key;\n                    let td = [];\n\n                    //@Todo, need to use the schema here -> we need to get the attributes of the document based on the fields in the schema, can't just iterate over the object as there maybe missing / null fields.\n                    for(let field in schema.properties){\n                        console.debug(\"Processing \"+ JSON.stringify(field));\n\n                        td.push(<td key={schema.title+\".\"+field}>{eval(\"obj.\"+field)}</td>);\n                    }\n\n                    //\n                    body.push(<tr key={key}>\n                        {td}\n                        <td>\n                            <span onClick={() => this.delete(schema, doc.id)} className=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span>\n                        </td></tr>);\n\n                    key++;\n                }.bind(this));\n\n                this.setState({\n                    body:body\n                });\n            }\n        }.bind(this));\n    }\n\n    /**\n     * Remove the object from the DB associated with the Schema\n     *\n     * @param schema\n     * @param id\n     */\n    delete(schema, id){\n        console.debug(\"Delete \"+schema.title+\" with ID \"+id);\n        let db = new PouchDB(schema.title);\n\n        db.get(id, function(err, doc){\n            db.remove(doc, function(err, response){\n                if(err)\n                    console.error(err);\n\n                this.getData(schema);\n            }.bind(this));\n        }.bind(this));\n    }\n\n\n    /**\n     * Read the schema from the DB, display the table header and call on to next which should render the data table.\n     *\n     * @param next\n     */\n    getSchema(next){\n        let db = new PouchDB(SCHEMA_DB);\n\n        db.get(this.props.id, function(err, doc){\n            if(err){\n                console.error(err);\n            }\n            else{\n                console.debug(\"Building Table Header for \"+JSON.stringify(doc));\n\n                //Setup a new dialog\n                let dialog = <GenericDialog next={this.getData} id={\"dialog\"+doc._id} body={\"New \"+doc.title} modal={true} schema={doc}/>;\n\n                let props = doc.properties;\n\n                let th=[];\n                for(let x in props){\n                    th.push(<th key={x}>{x}</th>);\n                }\n\n                let button = <th key=\"button\"><button onClick={() => this.showDialog(\"dialog\"+doc._id)} className=\"btn btn-primary\">{\"New \"+doc.title}</button></th>;\n                th.push(button);\n\n                this.setState({\n                    head:th,\n                    dialog:dialog\n                });\n            }\n            //now populate the data table\n            next(doc);\n        }.bind(this));\n    }\n\n    showDialog(id){\n        console.debug(\"Showing dialog with ID \"+id);\n\n        $(\"#\"+id).dialog(\"open\");\n    }\n\n    render(){\n        return <div>\n            {this.state.dialog}\n            <table className=\"table table-striped\">\n                <thead>\n                <tr>{this.state.head}</tr>\n                </thead>\n                <tbody>\n                {this.state.body}\n                </tbody>\n            </table>\n        </div>\n    }\n}"]}